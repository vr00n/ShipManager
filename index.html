<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ship Management Platform</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>

    <!-- Load all libraries at the end of the body, before the main app script. -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/1.30.1/date_fns.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { subDays, startOfWeek, endOfWeek, subMonths, startOfMonth, endOfMonth, subQuarters, startOfQuarter, endOfQuarter, format } = dateFns;

        // --- Inlined SVG Icons to replace the Lucide library dependency ---
        const Icon = ({ children, className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>;
        const Ship = ({className}) => <Icon className={className}><path d="M3.5 20.5a.5.5 0 0 1-.5-.5v-5a.5.5 0 0 1 1 0v5a.5.5 0 0 1-.5.5Z"/><path d="M20.5 20.5a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 .5.5Z"/><path d="M3.5 15.5a.5.5 0 0 1 0-1h18a.5.5 0 0 1 0 1Z"/><path d="M12 3a2 2 0 0 0-2 2v10h4V5a2 2 0 0 0-2-2Z"/><path d="M12 3h-2a2 2 0 0 0-2 2v10h4"/><path d="M12 3h2a2 2 0 0 1 2 2v10h-4"/><path d="m19 15-7-12-7 12"/></Icon>;
        const Wrench = ({className}) => <Icon className={className}><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></Icon>;
        const BarChart2 = ({className}) => <Icon className={className}><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></Icon>;
        const AlertTriangle = ({className}) => <Icon className={className}><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></Icon>;
        const ClipboardList = ({className}) => <Icon className={className}><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></Icon>;
        const Home = ({className}) => <Icon className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>;
        const FileText = ({className}) => <Icon className={className}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></Icon>;
        const ShoppingCart = ({className}) => <Icon className={className}><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></Icon>;
        const Cog = ({className}) => <Icon className={className}><path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16z"/><path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/><path d="M12 2v2"/><path d="M12 22v-2"/><path d="m17 20.66-1-1.73"/><path d="m7 3.34 1 1.73"/><path d="m17 3.34-1 1.73"/><path d="m7 20.66 1-1.73"/><path d="M2 12h2"/><path d="M22 12h-2"/><path d="m3.34 7 1.73 1"/><path d="m20.66 17-1.73-1"/><path d="m3.34 17 1.73-1"/><path d="m20.66 7-1.73 1"/></Icon>;
        
        // --- Data Generation Utility ---
        const generateSampleData = () => {
            const vesselNames = [ "Oceanic Voyager", "Starlight Mariner", "Neptune's Chariot", "Coastal Pioneer", "Arctic Tern", "Southern Cross", "Pacific Wanderer", "Atlantic Sprinter", "Indus Trader", "Caribbean Queen", "Boreal Carrier", "Equinox Drifter", "Solaris Freighter", "Lunar Transporter", "Polaris Explorer" ];
            const vesselTypes = ["Bulk Carrier", "Oil Tanker", "Container Ship", "Gas Carrier", "Ro-Ro"];
            const flags = ["Panama", "Liberia", "Marshall Islands", "Singapore", "Hong Kong"];
            const today = new Date('2025-08-08T10:00:00Z');

            const vessels = Array.from({ length: 15 }, (_, i) => ({ id: `vessel-${String(i + 1).padStart(3, '0')}`, name: vesselNames[i], imo: 9000000 + i, type: vesselTypes[i % vesselTypes.length], flag: flags[i % flags.length] }));
            let performance = [], maintenance = [], spares = [], surveys = [], engine = [], issues = [];
            let mId = 1, sId = 1, suId = 1, pId = 1, eId = 1, iId = 1;

            vessels.forEach((v, i) => {
                for (let j = 120; j >= 0; j--) {
                    const date = subDays(today, j);
                    const dateStr = format(date, 'YYYY-MM-DD');
                    performance.push({ id: `p${pId++}`, vesselId: v.id, date: dateStr, speed: 12 + Math.random() * 2, fuelConsumption: 25 + Math.random() * 5, fuelDeviation: -2 + Math.random() * 4, availability: Math.random() > 0.02 ? 100 : 0, engineStatus: 'Normal', remarks: 'No issues' });
                    engine.push({ id: `e${eId++}`, vesselId: v.id, date: dateStr, exhaustTemp: 350 + Math.random() * 25, turboRpm: 18000 + Math.random() * 500, lubeOilPressure: 4.2 + Math.random() * 0.6 });
                }
                for(let k = 0; k < 5; k++) {
                    const dueDate = format(subDays(today, Math.random() * 90 - 30), 'YYYY-MM-DD');
                    const isOverdue = new Date(dueDate) < today;
                    maintenance.push({ id: `m${mId++}`, vesselId: v.id, task: `Component ${k+1} Service`, dueDate, status: isOverdue ? 'Overdue' : 'Upcoming', priority: ['Low', 'Medium', 'High'][k % 3], completedDate: isOverdue && Math.random() > 0.5 ? format(subDays(today, Math.random() * 30), 'YYYY-MM-DD') : null });
                }
                for(let l = 0; l < 3; l++) {
                    const reportedDate = format(subDays(today, Math.random() * 90), 'YYYY-MM-DD');
                    const isOpen = Math.random() > 0.4;
                    issues.push({ id: `i${iId++}`, vesselId: v.id, issue: `Minor Leak in System ${l+1}`, reportedDate, resolvedDate: isOpen ? null : format(subDays(today, Math.random() * 30), 'YYYY-MM-DD'), status: isOpen ? 'Open' : 'Closed', priority: 'Medium' });
                }
                spares.push({ id: `s${sId++}`, vesselId: v.id, item: `PD #${1000+sId}`, quantity: 10, status: ['Pending', 'Confirmed', 'Delivered'][sId % 3], poNumber: `PO-2025-${100+sId}` });
                surveys.push({ id: `su${suId++}`, vesselId: v.id, name: 'Annual Safety Survey', dueDate: format(subDays(today, -60), 'YYYY-MM-DD'), status: 'Scheduled' });
                if (i % 4 === 0) {
                    surveys.push({ id: `su${suId++}`, vesselId: v.id, name: 'Underwater Inspection (UWILD)', dueDate: format(subDays(today, -40), 'YYYY-MM-DD'), status: 'Requires Planning' });
                }
            });

            const kpis = [ { key: 'fleetAvailability', value: 98.5, type: 'number' }, { key: 'avgFuelDiff', value: 2.1, type: 'number' } ];
            return { vessels, performance, maintenance, spares, surveys, engine, issues, kpis };
        };
        
        const Card = ({ children, className = '' }) => <div className={`bg-white rounded-lg shadow-sm overflow-hidden ${className}`}>{children}</div>;
        const CardHeader = ({ title, icon, action }) => <div className="p-4 border-b border-gray-200 flex justify-between items-center"><h3 className="text-md font-semibold text-gray-700">{title}</h3>{action}</div>;
        const CardContent = ({ children, className = '' }) => <div className={`p-4 ${className}`}>{children}</div>;
        const StatusBadge = ({ status }) => { const statusClasses = { Overdue: 'bg-red-100 text-red-800', Pending: 'bg-yellow-100 text-yellow-800', Confirmed: 'bg-blue-100 text-blue-800', Delivered: 'bg-green-100 text-green-800', Upcoming: 'bg-blue-100 text-blue-800', Scheduled: 'bg-green-100 text-green-800', 'Requires Planning': 'bg-yellow-100 text-yellow-800' }; return <span className={`px-2 py-1 text-xs font-medium rounded-full ${statusClasses[status] || 'bg-gray-200 text-gray-800'}`}>{status}</span>; };
        const TableWrapper = ({ children }) => <div className="overflow-x-auto"><table className="w-full text-sm text-left text-gray-500">{children}</table></div>;
        const THead = ({ children }) => <thead className="text-xs text-gray-700 uppercase bg-gray-50">{children}</thead>;
        const TRow = ({ children, className='' }) => <tr className={`bg-white border-b ${className}`}>{children}</tr>;
        const Th = ({ children }) => <th scope="col" className="px-6 py-3">{children}</th>;
        const Td = ({ children, className='' }) => <td className={`px-6 py-4 ${className}`}>{children}</td>;

        const ChartJsComponent = ({ type, data, options }) => {
            const canvasRef = useRef(null);
            const chartRef = useRef(null);

            useEffect(() => {
                if (chartRef.current) { chartRef.current.destroy(); }
                const ctx = canvasRef.current.getContext('2d');
                chartRef.current = new Chart(ctx, { type, data, options });
                return () => { if (chartRef.current) { chartRef.current.destroy(); } };
            }, [data, type, options]);

            return <canvas ref={canvasRef}></canvas>;
        };

        const Sidebar = ({ activeView, setView }) => {
            const navItems = [
                { id: 'dashboard', label: 'Dashboard', icon: <Home className="w-5 h-5"/> },
                { id: 'vesselReports', label: 'Vessel Reports', icon: <FileText className="w-5 h-5"/> },
                { id: 'maintenance', label: 'Planned Maintenance', icon: <Wrench className="w-5 h-5"/> },
                { id: 'purchaseOrders', label: 'Purchase Orders', icon: <ShoppingCart className="w-5 h-5"/> },
                { id: 'classSurveys', label: 'Class Surveys', icon: <ClipboardList className="w-5 h-5"/> },
                { id: 'enginePerformance', label: 'Engine Performance', icon: <Cog className="w-5 h-5"/> },
            ];

            return (
                <aside className="w-64 bg-[#2c3e50] text-white flex flex-col flex-shrink-0">
                    <div className="p-4 border-b border-gray-700">
                        <img src="logo.png" alt="ShipManager Logo" className="h-12 mx-auto" />
                    </div>
                    <nav className="flex-1 p-4">
                        <ul>
                            {navItems.map(item => (
                                <li key={item.id}>
                                    <a href="#" onClick={(e) => { e.preventDefault(); setView(item.id); }}
                                       className={`flex items-center space-x-3 p-3 rounded-lg transition-colors ${activeView === item.id ? 'bg-blue-500' : 'hover:bg-gray-700'}`}>
                                        {item.icon}
                                        <span>{item.label}</span>
                                    </a>
                                </li>
                            ))}
                        </ul>
                    </nav>
                </aside>
            );
        };
        
        const DashboardView = ({ shipData }) => {
            const [selectedVesselId, setSelectedVesselId] = useState(shipData.vessels[0].id);
            
            const featuredVessel = shipData.vessels.find(v => v.id === selectedVesselId);
            const latestReport = shipData.performance.filter(p => p.vesselId === selectedVesselId).sort((a,b) => new Date(b.date) - new Date(a.date))[0];
            const maintenanceTasks = shipData.maintenance.filter(m => new Date(m.dueDate) >= new Date()).sort((a,b) => new Date(a.dueDate) - new Date(b.dueDate)).slice(0, 4);
            const purchaseOrders = shipData.spares.sort((a,b) => b.id.localeCompare(a.id)).slice(0, 3);
            const classSurveys = shipData.surveys.filter(s => new Date(s.dueDate) >= new Date()).sort((a,b) => new Date(a.dueDate) - new Date(b.dueDate)).slice(0, 2);
            const enginePerformanceData = shipData.engine.filter(e => e.vesselId === selectedVesselId).slice(-30);

            const chartData = {
                labels: enginePerformanceData.map(d => format(new Date(d.date), 'MM-DD')),
                datasets: [{
                    label: 'Exhaust Temp',
                    data: enginePerformanceData.map(d => d.exhaustTemp),
                    borderColor: '#3498db',
                    tension: 0.3,
                    pointRadius: 0,
                }]
            };
            const chartOptions = { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } };

            if (!latestReport) {
                return <div>Loading report...</div>;
            }

            return (
                <div className="space-y-6">
                    <Card>
                        <CardHeader 
                            title="Daily Vessel Report" 
                            action={
                                <select value={selectedVesselId} onChange={e => setSelectedVesselId(e.target.value)} className="block w-48 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                    {shipData.vessels.map(v => <option key={v.id} value={v.id}>{v.name}</option>)}
                                </select>
                            }
                        />
                        <CardContent>
                            <div className="grid grid-cols-2 gap-x-8 gap-y-4">
                                <div className="font-semibold text-gray-600">Vessel</div><div>{featuredVessel.name}</div>
                                <div className="font-semibold text-gray-600">Date</div><div>{format(new Date(latestReport.date), 'MMMM DD')}</div>
                                <div className="font-semibold text-gray-600">Speed (kn)</div><div>{latestReport.speed.toFixed(1)}</div>
                                <div className="font-semibold text-gray-600">Fuel Consumption (mt)</div><div>{latestReport.fuelConsumption.toFixed(1)}</div>
                                <div className="font-semibold text-gray-600">Engine Status</div><div>{latestReport.engineStatus}</div>
                                <div className="font-semibold text-gray-600">Remarks</div><div>{latestReport.remarks}</div>
                            </div>
                        </CardContent>
                    </Card>
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <Card>
                            <CardHeader title="Planned Maintenance" />
                            <CardContent>
                                <ul className="space-y-3">
                                    {maintenanceTasks.map(task => (
                                        <li key={task.id} className="flex justify-between items-center text-gray-700 border-b pb-2 last:border-b-0">
                                            <span>{task.task}</span>
                                            <span className={`font-semibold ${new Date(task.dueDate) < new Date() ? 'text-red-500' : ''}`}>{format(new Date(task.dueDate), 'MMM DD')}</span>
                                        </li>
                                    ))}
                                </ul>
                            </CardContent>
                        </Card>
                         <Card>
                            <CardHeader title="Upcoming Class Surveys" />
                            <CardContent>
                                <ul className="space-y-3">
                                    {classSurveys.map(survey => (
                                        <li key={survey.id} className="flex justify-between items-center text-gray-700 border-b pb-2 last:border-b-0">
                                            <span>{survey.name}</span>
                                            <span className="font-semibold">{format(new Date(survey.dueDate), 'MMM DD')}</span>
                                        </li>
                                    ))}
                                </ul>
                            </CardContent>
                        </Card>
                        <Card>
                            <CardHeader title="Recent Purchase Orders" />
                            <CardContent>
                                <ul className="space-y-3">
                                    {purchaseOrders.map(po => (
                                        <li key={po.id} className="flex justify-between items-center text-gray-700 border-b pb-2 last:border-b-0">
                                            <span>{po.item}</span>
                                            <StatusBadge status={po.status} />
                                        </li>
                                    ))}
                                </ul>
                            </CardContent>
                        </Card>
                        <Card>
                            <CardHeader title={`Engine Performance - ${featuredVessel.name}`} />
                            <CardContent>
                                <div className="h-32">
                                    <ChartJsComponent type="line" data={chartData} options={chartOptions} />
                                </div>
                            </CardContent>
                        </Card>
                    </div>
                </div>
            );
        };

        const FleetDataView = ({ title, data, headers, rowRenderer, vessels }) => {
            const [filter, setFilter] = useState('all');
            const filteredData = filter === 'all' ? data : data.filter(item => item.vesselId === filter);

            return (
                <Card>
                    <CardHeader title={title} action={
                        <select value={filter} onChange={e => setFilter(e.target.value)} className="block w-48 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            <option value="all">All Vessels</option>
                            {vessels.map(v => <option key={v.id} value={v.id}>{v.name}</option>)}
                        </select>
                    }/>
                    <CardContent>
                        <TableWrapper>
                            <THead><tr>{headers.map(h => <Th key={h}>{h}</Th>)}</tr></THead>
                            <tbody>{filteredData.map(item => rowRenderer(item))}</tbody>
                        </TableWrapper>
                    </CardContent>
                </Card>
            );
        };

        const App = () => {
            const [shipData, setShipData] = useState(null);
            const [view, setView] = useState('dashboard'); 
            
            useEffect(() => { setShipData(generateSampleData()); }, []);

            const renderView = () => {
                if (!shipData) return <div className="text-center p-12">Loading data...</div>;
                switch (view) {
                    case 'dashboard':
                        return <DashboardView shipData={shipData} />;
                    case 'vesselReports':
                        return <FleetDataView title="Vessel Reports" data={shipData.performance} headers={['Date', 'Vessel', 'Speed (kn)', 'Fuel (mt)']} vessels={shipData.vessels} rowRenderer={item => <TRow key={item.id}><Td>{item.date}</Td><Td>{shipData.vessels.find(v=>v.id===item.vesselId)?.name}</Td><Td>{item.speed.toFixed(1)}</Td><Td>{item.fuelConsumption.toFixed(1)}</Td></TRow>} />;
                     case 'maintenance':
                        return <FleetDataView title="Planned Maintenance" data={shipData.maintenance} headers={['Vessel', 'Task', 'Due Date', 'Status']} vessels={shipData.vessels} rowRenderer={item => <TRow key={item.id}><Td>{shipData.vessels.find(v=>v.id===item.vesselId)?.name}</Td><Td>{item.task}</Td><Td>{item.dueDate}</Td><Td><StatusBadge status={item.status}/></Td></TRow>} />;
                    case 'purchaseOrders':
                        return <FleetDataView title="Purchase Orders" data={shipData.spares} headers={['Vessel', 'Item', 'PO Number', 'Status']} vessels={shipData.vessels} rowRenderer={item => <TRow key={item.id}><Td>{shipData.vessels.find(v=>v.id===item.vesselId)?.name}</Td><Td>{item.item}</Td><Td>{item.poNumber}</Td><Td><StatusBadge status={item.status}/></Td></TRow>} />;
                    case 'classSurveys':
                        return <FleetDataView title="Class Surveys" data={shipData.surveys} headers={['Vessel', 'Survey', 'Due Date', 'Status']} vessels={shipData.vessels} rowRenderer={item => <TRow key={item.id}><Td>{shipData.vessels.find(v=>v.id===item.vesselId)?.name}</Td><Td>{item.name}</Td><Td>{item.dueDate}</Td><Td><StatusBadge status={item.status}/></Td></TRow>} />;
                    case 'enginePerformance':
                        return <FleetDataView title="Engine Performance" data={shipData.engine} headers={['Date', 'Vessel', 'Exhaust Temp', 'Turbo RPM']} vessels={shipData.vessels} rowRenderer={item => <TRow key={item.id}><Td>{item.date}</Td><Td>{shipData.vessels.find(v=>v.id===item.vesselId)?.name}</Td><Td>{item.exhaustTemp.toFixed(0)}</Td><Td>{item.turboRpm.toFixed(0)}</Td></TRow>} />;
                    default: 
                        return <DashboardView shipData={shipData} />;
                }
            };

            return (
                <div className="bg-[#f0f2f5] min-h-screen font-sans text-gray-900 flex">
                    <Sidebar activeView={view} setView={setView} />
                    <div className="flex-1 flex flex-col">
                        <header className="bg-white shadow-sm p-4 flex justify-between items-center">
                            <h1 className="text-xl font-bold text-gray-800 capitalize">{view.replace(/([A-Z])/g, ' $1')}</h1>
                            <div className="text-right">
                                <p className="font-semibold">John Doe</p>
                            </div>
                        </header>
                        <main className="p-6 overflow-y-auto flex-1">
                            {renderView()}
                        </main>
                    </div>
                </div>
            );
        }
        
        function runWhenReady() {
            if (window.React && window.ReactDOM && window.Chart && window.dateFns) {
                const container = document.getElementById('root');
                const root = ReactDOM.createRoot(container);
                root.render(<App />);
            } else {
                setTimeout(runWhenReady, 100);
            }
        }

        runWhenReady();
    </script>
  </body>
</html>
